// Prisma schema for NovaTrade

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(uuid())
  email             String    @unique
  password          String
  transactionPassword String?
  nickname          String?
  avatar            String?
  vipLevel          String    @default("V")
  inviteCode        String    @unique
  invitedBy         String?
  kycStatus         String    @default("none") // none, pending, approved, rejected
  kycName           String?
  kycIdNumber       String?
  kycCountry        String?
  isAdmin           Boolean   @default(false)
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  wallets           Wallet[]
  deposits          Deposit[]
  withdrawals       Withdrawal[]
  robotOrders       RobotOrder[]
  loans             Loan[]
  notifications     Notification[]
  chatMessages      ChatMessage[]

  @@map("users")
}

model Wallet {
  id        String  @id @default(uuid())
  userId    String
  coin      String
  available Float   @default(0)
  frozen    Float   @default(0)
  account   String  @default("spot") // spot, contract, financial

  user User @relation(fields: [userId], references: [id])

  @@unique([userId, coin, account])
  @@map("wallets")
}

model Deposit {
  id          String   @id @default(uuid())
  userId      String
  coin        String
  network     String
  amount      Float
  address     String
  txHash      String?
  status      String   @default("pending") // pending, approved, rejected
  reviewedBy  String?
  reviewNote  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@map("deposits")
}

model Withdrawal {
  id          String   @id @default(uuid())
  userId      String
  coin        String
  network     String
  amount      Float
  fee         Float    @default(0)
  address     String
  txHash      String?
  status      String   @default("pending") // pending, approved, rejected
  reviewedBy  String?
  reviewNote  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@map("withdrawals")
}

model SpotOrder {
  id        String   @id @default(uuid())
  userId    String
  pair      String
  side      String   // buy, sell
  type      String   // limit, market
  price     Float
  amount    Float
  filled    Float    @default(0)
  status    String   @default("open") // open, filled, cancelled
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("spot_orders")
}

model ContractOrder {
  id          String   @id @default(uuid())
  userId      String
  pair        String
  side        String   // long, short
  leverage    Int
  margin      Float
  entryPrice  Float
  exitPrice   Float?
  pnl         Float?
  status      String   @default("open") // open, closed, liquidated
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("contract_orders")
}

model Robot {
  id          String   @id @default(uuid())
  name        String
  price       Float
  dailyReturn Float
  fixedProfit Float    @default(0)
  period      Int      @default(3)
  minLevel    String   @default("V")
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  orders RobotOrder[]

  @@map("robots")
}

model RobotOrder {
  id        String   @id @default(uuid())
  userId    String
  robotId   String
  amount    Float
  earned    Float    @default(0)
  status    String   @default("running") // running, completed, cancelled
  startDate DateTime @default(now())
  endDate   DateTime

  user  User  @relation(fields: [userId], references: [id])
  robot Robot @relation(fields: [robotId], references: [id])

  @@map("robot_orders")
}

model Loan {
  id           String   @id @default(uuid())
  userId       String
  amount       Float
  repayAmount  Float
  status       String   @default("active") // active, repaid, overdue
  dueDate      DateTime
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@map("loans")
}

model WithdrawAddress {
  id        String   @id @default(uuid())
  userId    String
  label     String
  coin      String
  network   String
  address   String
  createdAt DateTime @default(now())

  @@map("withdraw_addresses")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String   // system, transaction, price
  title     String
  content   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@map("notifications")
}

model ChatMessage {
  id        String   @id @default(uuid())
  userId    String
  message   String
  fromBot   Boolean  @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@map("chat_messages")
}

model VerifyCode {
  id        String   @id @default(uuid())
  email     String
  code      String
  type      String   // register, reset, transaction
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("verify_codes")
}

model Activity {
  id          String   @id @default(uuid())
  title       String
  description String
  content     String
  bgColor     String
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@map("activities")
}

model SiteConfig {
  id    String @id @default(uuid())
  key   String @unique
  value String

  @@map("site_config")
}

model Banner {
  id          String   @id @default(uuid())
  title       String
  description String?
  imageUrl    String
  linkUrl     String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("banners")
}
